# For full config options, check the docs:
#    docs.serverless.com

service: why82-calc

plugins:
  - python-deps

provider:
  name: aws
  runtime: python2.7
  region: us-west-2
  timeout: 30
  stage: dev
  iamRoleStatements:
    - Effect: Allow
      Action:
        - s3:PutObject
      Resource:
        Fn::Join:
          - ''
          - - "arn:aws:s3:::"
            - Ref: DataBucket
            - '/*'

package:
  exclude:
    - tests
    - out
    - .idea
    - .vagrant
    - why82.tar.gz
    - invoke.yaml
    - README.md
    - LICENSE
    - deps_package.sh
    - deps_pull.sh
    - deps_setup.sh
    - Vagrantfile
    - .DS_Store
    - node_modules
    - package.json
    - .coverage
    - why82.lambda.iml
    - __pycache__
    - python-deps

functions:
  tiers:
    handler: calc_tiers.lambda_handler
#      - s3: something
  schedule:
    handler: calc_schedule.lambda_handler
#      - s3: something

resources:
  Resources:
    DataBucket:
      Type: AWS::S3::Bucket
      Properties:
        BucketName: ${self:service}-${opt:stage, self:provider.stage}
        CorsConfiguration:
          CorsRules:
            - MaxAge: 3600
              AllowedOrigins:
                - http://*.why82.com
              AllowedMethods:
                - GET
  Outputs:
     DataBucket:
       Description: 'The bucket where stats will be stored'
       Value:
         Ref: DataBucket
